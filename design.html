<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Hypper Design - Hypper documentation</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="design.html" class="active"><strong aria-hidden="true">1.</strong> Hypper Design</a></li><li class="chapter-item expanded "><a href="user/tutorials/installing.html"><strong aria-hidden="true">2.</strong> Installing</a></li><li class="chapter-item expanded "><a href="user/tutorials/quickstart.html"><strong aria-hidden="true">3.</strong> Quick Start</a></li><li class="chapter-item expanded "><a href="user/howto/index.html"><strong aria-hidden="true">4.</strong> How tos</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="user/howto/expandcharthypper.html"><strong aria-hidden="true">4.1.</strong> Expand a chart with Hypper annotations</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Hypper documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <a href="https://github.com/rancher-sandbox/hypper" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#hypper-design" id="hypper-design">Hypper Design</a></h1>
<p>Hypper is a package manager built on Helm and inspired by other package managers
like zypper.</p>
<h2><a class="header" href="#how-hypper-differs-from-helm" id="how-hypper-differs-from-helm">How Hypper Differs From Helm</a></h2>
<p>Why build a package manager on a package manager? Helm is a package manager that
tries to make few assumptions. For example, Custom Resource Definitions (CRD)s
are a Kubernetes resource that extend the Kubernetes API. They can be used in
various ways and there are pitfalls with them. Helm makes very few assumptions
when it comes to them. Hypper is going to make some different assumptions which
will result in different features.</p>
<p>As differences between Hypper and Helm arise they will be documented along with
the reasons for the difference. This is in an effort to provide clarity.</p>
<p>When features from Hypper can be upstreamed into Helm they will be. In that way,
Hypper can act as a testing ground for Helm. We do not expect that every feature
will fit in upstream Helm.</p>
<p>A second element in the difference is that Helm, as a package manager, does not
handle environment deployment operations. Those are left to higher level tools
like Helmfile (a push model like Ansible) and the Flux Helm Operator (a pull
model like Chef). Helm expects higher level tools will use Helm and charts for
operating in different environments.</p>
<p>Hypper will move will make some assumptions that move it more towards the
environment management. This is in a different way from Helmfile or the Flux
Helm Operator but further than Helm will go.</p>
<h2><a class="header" href="#directory-structure" id="directory-structure">Directory Structure</a></h2>
<p>The directory structure is inspired by Helm with the following layout.</p>
<pre><code>.
├── cmd
│   └── hypper
├── docs
└── pkg
    └── action 
    └── ... 
</code></pre>
<ul>
<li>The <em>cmd/hypper</em> directory contains the client application. This CLI for mac,
linux, and windows is both a functional application and reference application
of the library.</li>
<li><em>docs</em> contains documentation on the design and usage of hypper.</li>
<li>The <em>pkg</em> directory contains a library meant to be imported by <em>cmd/hypper</em> and
other applications. The functionality needed is implemented here.</li>
<li><em>pkg/actions</em> contains the main functionality used by <em>cmd/hypper</em>.</li>
</ul>
<p>This is the same layout as Helm itself.</p>
<h2><a class="header" href="#design-intent" id="design-intent">Design Intent</a></h2>
<p>The following outline the initial major intentions of hypper.</p>
<h3><a class="header" href="#build-upon-helm" id="build-upon-helm">Build Upon Helm</a></h3>
<p>Helm provides much of the functionality we need. There are some areas we want
to deviate from it. Where Hypper can, it will leverage what Helm already does.
This includes repositories, charts, and how storage occurs for charts (unless we
create a new adapter).</p>
<h3><a class="header" href="#modern-terminal-ui" id="modern-terminal-ui">Modern Terminal UI</a></h3>
<p>Colors and icons are often present in modern terminals. Sometimes referred to
as eye candy, these features can improve user experience by drawing attention to
important things.</p>
<h3><a class="header" href="#optional-dependencies" id="optional-dependencies">Optional Dependencies</a></h3>
<p>In Helm, with Hypper is built on, there are two ways to handle dependencies.</p>
<ol>
<li>Explicitly declare other charts as dependencies. This will cause those charts
to be installed. When the templates are rendered they happen in the same
sandboxed environment.</li>
<li>Install charts separately and use values to connect them to each other. For
example, install PostreSQL with one chart and then pass connection information
into another chart using a Secret or values that generate a Secret.</li>
</ol>
<p>Hypper will support both of these types of dependencies an add a 3rd form of
dependency via an optional dependency. For example, you are developing something
that requires a prometheus CRD. You can depend on a chart that provides that CRD
but does not provide prometheus. The CRD chart or your chart can declare an
optional dependency on a chart that installs Prometheus. When using hypper to
install your chart you will be asked about installing the optional dependencies.
In development you can choose not to install the dependencies while in production
you can choose to install them.</p>
<p>The optional dependency handling will extend to all commands.</p>
<p>Optional dependencies will be specified using Helm chart annotations. This
enables the representation to be stored in the existing Helm chart structure.</p>
<h3><a class="header" href="#shared-dependencies" id="shared-dependencies">Shared Dependencies</a></h3>
<p>Sometimes you want to have a shared system dependency. For example, you may want
to have just a single Prometheus or Istio in a cluster. When you install an
application that depends on this shared dependency you want to install it if not
present and leverage the existing one if present.</p>
<p>With Helm there is a separation between those who provide charts and those who
consume them. Charts from various repositories can be installed in the same
cluster but are not guaranteed to work together. That is left as an exercise for
the chart authors.</p>
<p>Hypper will make it easier to have a repository of charts that work together but
can be installed separately.</p>
<p>The additional metadata will be stored as Helm chart annotations.</p>
<h3><a class="header" href="#oci-storage" id="oci-storage">OCI Storage</a></h3>
<p>OCI artifacts are a new way to store things. Helm supports storing Helm charts
in OCI distributions as an experimental feature. Many container registries
support storing non-images in them. The list includes Azure, AWS, Google Cloud,
GitHub Container Registry, and Harbor. The one notable exception is Docker Hub.</p>
<p>Kubernetes already needs to have a container registry. In air gapped, on-premise,
and custom environments you need a registry to store your images. If that can be
used to store charts instead of a separate system you have fewer system
dependencies.</p>
<p>Hypper will make OCI registries a primary element in the system.</p>
<p>One notable disadvantage to using an OCI registry for storing charts is a lack of
an <code>index.yaml</code> file. This file has metadata enabling some functionality that
can't be duplicated with an OCI registry due to APIs not existing (e.g., search).
To restore these features we are looking to put an index into an OCI registry.</p>
<p>Hypper will enable you to store the <code>index.yaml</code> file in an OCI registry in a
similar manner to an image or a chart. You will then be able to use it with
normal repo commands (e.g., <code>helm repo add test oci://ghcr.io/mattfarina/repoexample</code>).</p>
<h3><a class="header" href="#name-as-chart-identifier" id="name-as-chart-identifier">Name As Chart Identifier</a></h3>
<p>Zypper, the package manager used for openSUSE and other Linux distributions,
uses the package name as the identifier for it. You can change from one vendor
to another for a package with some differences but still the same package.</p>
<p>Helm does not make this form of assumption. It could be true. For example, you
could install a chart from one location and then update from a fork in another
location. Or two charts with the same name could be completely different. It
is the responsibility of the end user to make this decision.</p>
<p>Hypper is going to make the assumption that charts of the same name are the
same chart from different locations.</p>
<h3><a class="header" href="#performance" id="performance">Performance</a></h3>
<p>When working with many files over a network there are opportunities to use
caching, features of protocols, and design choices to improve performance. The
following examples illustrate this:</p>
<ul>
<li>JSON is faster to parse and uses less memory than YAML does. An <code>index.json</code>
file would faster and less memory intensive for Helm to work with than
<code>index.yaml</code>. A change like this could be done in a backwards compatible
manner.</li>
<li><code>index.yaml</code> files are regularly pulled down to get updates and this is a
manual step. Using HTTP headers we can check if the content changed and only
pull it in those cases. By doing that some of the updates can be automated,
as well. A header that could be used, for example, is <code>etag</code>.</li>
<li>Charts can be stored locally in a cache and used from there rather than being
downloaded each time. This cache could be stored in places like a CI system
(e.g., like the way packages are stored for programming languages) or on a
local development computer.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        
                            <a rel="next" href="user/tutorials/installing.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
                    <a rel="next" href="user/tutorials/installing.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
